<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:foaf="http://xmlns.com/foaf/0.1/" 
	xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#">
  <head>
  	<!-- meta data -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Media Fragment Player Demo page</title>
    <meta name="description" content="This is media fragment player demo page" />
    <meta name="author" content="Yunjia Li" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- stylessheets -->
   	<link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.3.0/bootstrap.min.css" media="all" />
    <link rel="stylesheet" href="css/default.css" media="all" />
    <!-- javascript -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script type="text/javascript" src="js/dependencies/jquery.media.js"></script>
    <script type="text/javascript" src="js/dependencies/jquery.url.js"></script>
	<script type="text/javascript" src="js/dependencies/jwplayer/jwplayer.js"></script>
	<script type="text/javascript" src="js/dependencies/wmvplayer/silverlight.js"></script>
	<script type="text/javascript" src="js/dependencies/wmvplayer/wmvplayer.js"></script>
	<script type="text/javascript" src="js/dependencies/swfobject.js"></script>
	<script type="text/javascript" src="js/dependencies/jquery.timers.js"></script>
	<script type="text/javascript" src="js/dependencies/mediafragments.js"></script>
	<script type="text/javascript" src="js/player.util.js"></script>
	<script type="text/javascript" src="js/player.settings.js"></script>
	<script type="text/javascript" src="js/Base.js"></script>
	<script type="text/javascript" src="js/player.mediafragment.controller.js"></script>
	<script type="text/javascript" src="js/player.multimedia.js"></script>
	<script type="text/javascript" src="js/player.multimedia_factory.js"></script>
    <script id="scriptInit" type="text/javascript">
    	var recording = null; //the object for multimedia resource
    	var factory = null; //multimedi player factory
    	var ctrler= null; //media fragment controller
    	var multimedia = null; // multimedia object which will be displayed on the web page
    	var mf_json = null; //Json object of media fragments information
    	var jw_swf_path = "swf/player.swf";
    	var jw_wmvplayer_path = "js/dependencies/wmvplayer/wmvplayer.xaml";
    	
		//In case I forget to remove console.log in IE
		var alertFallback = true;
		if (typeof console === "undefined" || typeof console.log === "undefined") {
		     console = {};
		     if (alertFallback) {
		         console.log = function(msg) {
		              //Do nothing
		         };
		     } else {
		         console.log = function() {};
		     }
		};
		//change xaml, swf path here!!!!!
		//Yes, you have to do it!
		$(document).ready(function(){
			//get URI
			var uri = $.getUrlVar("mfuri"); //getUrlVar is defined in player.util.js
			if(uri != null)
			{
				var uriStr = decodeURIComponent(uri);
				$("#mfuri").val(uriStr);
				mf_json = MediaFragments.parseMediaFragmentsUri(uriStr);
				//display mf information
				if(mf_json.hash == null && mf_json.query == null) // There is something wrong with the media fragment uri
				{
					var p_error = $("<p/>");
					p_error.text("Oops! The uri you provided is not valid.");
					$("#mf_info").addClass("alert-message block-message error").append(p_error);
				}
				else
				{
					var p_info = $("<p/>");
					p_info.text(mf_json.toString());
					$("#mf_info").addClass("alert-message block-message info").append(p_info);
				}
				//create new recording
				var recording_url = uriStr;
				recording = new Object();
				//Get the url without hash. We have to do this, because sometimes, request like:
				//test.ogv#t=1,3 won't let the player start to play!
				var indexOfHash = uriStr.indexOf('#');
				if(indexOfHash !=-1)
				{
					recording_url = uriStr.substring(0,indexOfHash);
				}
				//console.log("url:"+recording_url);
				recording.url = recording_url.replace(/ /g,"%20");
				//init factory
				factory = new MultimediaFactory(recording);
				multimedia = factory.getMultimediaPlayer(recording,$("#recording_content_div"),$("#multimedia_player_div"));
				if(multimedia != null)
				{
					ctrler = new MediaFragmentController();
					ctrler.start_playback();
					//timer.run();
				}
				else
				{
					//Display error message
					var message_p = $("<p/>");
					message_p.text("Cannot find an appropriate player! Please check the if the url is valid.");
					$("#mf_info").addClass("alert-message block-message error").append(message_p);
				}
			}
			else
			{
				//console.log("hide");
				$("#recording_content_div").hide();
			}
		});
	</script>
  </head>

  <body>
    <div class="topbar">
      <div class="fill">
        <div class="container">
          <a class="brand" href="#">Synote Media Fragment Player</a>
          <div class="pull-right">
          	<ul class="nav">
	            <li><a href="index.html">Home</a></li>
	            <li><a href="tc.html">Test Cases</a></li>
	            <li class="active"><a href="demo.html">Demo</a></li>
	            <li><a href="about.html">About</a></li>
	          </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="content">
        <div class="page-header">
          <h1>Demo Page</h1>
        </div>
        <div class="row">
          <div class="span16">
          	<form class="form-stacked" action="demo.html">
          		<fieldset>
          			<div class="clearfix">
          				<label for="mfuri">Please enter Media Fragment URI</label>
          				<div class="input">
          					<input id="mfuri" class="xlarge span8" type="text" name="mfuri" />
          				</div>
          			</div>
          			<input class="btn primary" type="submit" value="Play"></input>
					<input class="btn" type="reset" value="Reset"></input>
          		</fieldset>		
          	</form>
          	<div id="mf_info" class="span12" style="padding-top:15px;padding-bottom:15px;">
			</div>
            <div id="recording_content_div" class="span12" style="padding-left:20px;">
				<br/>
				<div class="row" id="multimedia_player_div">
				</div>
				<br/>
				<div class="row" id="recording_control_div">
					<button class="btn" id="control_play" title="Play">Play</button>
					<button class="btn" id="control_pause" title="Pause">Pause</button>
					<button class="btn" id="control_stop" title="Stop">Stop</button>
					<button class="btn" id="control_rewind" title="Rewind">Rewind</button>
					<button class="btn" id="control_forward" title="Forward">Forward</button>
					<div id="control_pace_div" class="combowrap" style="display:inline-block;">
						Pace:
						<select class="span2" name="control_pace_select" id="control_pace_select">
							<option value="1">1s</option>
							<option value="5">5s</option>
							<option value="10">10s</option>
							<option value="20">20s</option>
						</select>
					</div>
				</div>
		    </div>
		    <div class="span12" style="margin-top:15px;">
		    	<span class="label warning">Warning:</span>
		    	<ul>
		    		<li>
		    			Some file formats need to be cached before start playing from a certain offset.
		    		</li>
		    		<li>
		    			Sometimes you need to replace whitespace and "+" with "%20" in the URI if the player crashes.
		    		</li>
		    	</ul>
		    </div>		    
          </div>
        </div>
      </div>
      <footer>
        <p>&copy; 2011 University of Southampton</p>
      </footer>

    </div> <!-- /container -->

  </body>
</html>
